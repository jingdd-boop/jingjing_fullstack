#  nodejs中的异步、非阻塞I/O是如何实现的？

异步I/O ，非阻塞I/O

两种不同技术底层实现

## 1、什么是I/O
I/O就是 input/output 输入输出的意思
在浏览器端，只有一直IO就是利用Ajax发送网络请求，然后读取返回的内容，这属于 网络I/O

到node.js中，主要分为两种：
1、文件I/O 比如 用fs模块对文件进行读写操作
2、网络I/O，比如http模块发起网络请求

## 2、阻塞和非阻塞
阻塞和非阻塞I/O是针对操作系统内核而言的，而不是nodejs本身，
- 阻塞I/O的特点就是一定要等到操作系统完成所有操作后才表示调用接收
- 非阻塞I/O是调用后立马返回，不用等操作系统内核完成操作

当使用非阻塞I/O时可以减少等待的时间，但是nodejs如何知道操作系统以及完成了I/O操作呢

我们需要重复的去操作系统那里判断是否完成，这种重新判断的方式就是轮询

## 轮询方案
1、一直轮询检测I/O状态，知道I/O完成。性能比较低，因为会让CPU一直耗在上面。这样的话和阻塞I/O的效果是一样的
2、遍历文件描述符(即 文件I/O 时操作系统和 nodejs 之间的文件凭证)的方式来确定 I/O 是否完成，I/O完成则文件描述符的状态改变。但 CPU 轮询消耗还是很大。
3、epoll模式。即在进入轮询的时候如果I/O未完成CPU就休眠，完成之后唤醒CPU。

## 我们需要的是？
>nodejs 应用程序发起 I/O 调用后可以直接去执行别的逻辑，操作系统默默地做完 I/O 之后给 nodejs 发一个完成信号，nodejs 执行回调操作。

这是理想的情况，也是异步 I/O 的效果，那如何实现这样的效果呢？

## 异步I/O的本质
Linux下 （AIO），但是有两个缺陷
1、只有Linux下
2、无法理喻系统缓存

### nodejs中的异步I/O方案
单线程无法解决的事情，由多线程来搞
让一个进程进行金色操作，另一些进行I/O调用，I/O调用后把信号传给计算的线程，进而执行回调

异步I/O就是使用这样的线程池来实现

在 Linux 下可以直接使用线程池来完成，在Window系统下则采用 IOCP 这个系统API(其内部还是用线程池完成的)。

有了操作系统的支持 nodejs如何对接这些操作系统来实现异步I/O呢


